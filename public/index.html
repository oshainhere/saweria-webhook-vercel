<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saweria Webhook Server - Vercel</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 { color: #667eea; margin-bottom: 20px; }
    .status {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #10b981;
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: 600;
      margin-bottom: 30px;
    }
    .status::before {
      content: '';
      width: 12px;
      height: 12px;
      background: white;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .section {
      margin: 40px 0;
    }
    .section-title {
      color: #333;
      font-size: 1.5em;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 3px solid #667eea;
    }
    .endpoint {
      background: #f7fafc;
      border-left: 4px solid #667eea;
      padding: 15px;
      margin: 10px 0;
      border-radius: 8px;
      font-family: monospace;
      font-size: 0.9em;
    }
    .code-box {
      background: #1e293b;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 10px;
      font-family: monospace;
      font-size: 0.9em;
      overflow-x: auto;
      margin: 10px 0;
      position: relative;
    }
    .copy-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #667eea;
      color: white;
      border: none;
      padding: 5px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.85em;
    }
    .copy-btn:hover { background: #5568d3; }
    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      margin: 5px;
      transition: all 0.3s;
    }
    button:hover {
      background: #5568d3;
      transform: translateY(-2px);
    }
    button.danger { background: #ef4444; }
    button.danger:hover { background: #dc2626; }
    #response {
      background: #1e293b;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
      font-family: monospace;
      font-size: 0.85em;
      white-space: pre-wrap;
      display: none;
    }
    #response.show { display: block; }
    .info-box {
      background: #dbeafe;
      border-left: 4px solid #3b82f6;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }
    .badge {
      background: #10b981;
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.85em;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéâ Saweria Webhook Server</h1>
    <div class="status">VERCEL SERVERLESS</div>
    <span class="badge">Always-On 24/7</span>

    <div class="section">
      <h2 class="section-title">üì° API Endpoints</h2>
      <div class="endpoint">POST /api/webhook - Saweria webhook receiver</div>
      <div class="endpoint">GET /api/top-donators?limit=20 - Leaderboard</div>
      <div class="endpoint">GET /api/latest-donations - Latest 10 donations</div>
      <div class="endpoint">POST /api/test-donation - Create test</div>
      <div class="endpoint">POST /api/clear-data - Clear all</div>
      <div class="endpoint">GET /api/health - Health check</div>
    </div>

    <div class="section">
      <h2 class="section-title">üîß Setup Instructions</h2>
      <p><strong>1. Saweria Webhook URL:</strong></p>
      <div class="code-box">
        <span id="webhook-url">https://your-project.vercel.app/api/webhook</span>
        <button class="copy-btn" onclick="copyWebhook()">Copy</button>
      </div>
      
      <p><strong>2. Roblox DonationManager URL:</strong></p>
      <div class="code-box">
        <span id="base-url">https://your-project.vercel.app</span>
        <button class="copy-btn" onclick="copyBase()">Copy</button>
      </div>
      
      <p><strong>3. Set Environment Variable di Vercel:</strong></p>
      <ul style="margin: 15px 0 15px 30px; line-height: 1.8;">
        <li>Key: <code>SAWERIA_SECRET</code></li>
        <li>Value: (secret key dari Saweria)</li>
      </ul>
    </div>

    <div class="section">
      <h2 class="section-title">üß™ Test Controls</h2>
      <button onclick="testDonation()">üéÅ Create Test Donation</button>
      <button onclick="getLatest()">üìã Get Latest</button>
      <button onclick="getTop()">üèÜ Get Top</button>
      <button class="danger" onclick="clearData()">üóëÔ∏è Clear Data</button>
      <button onclick="location.reload()">üîÑ Refresh</button>
      <div id="response"></div>
    </div>

    <div class="info-box">
      <strong>‚úÖ Vercel Advantages:</strong>
      <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
        <li>Unlimited requests (gratis selamanya)</li>
        <li>Global Edge Network (super cepat)</li>
        <li>No sleep mode (always-on 24/7)</li>
        <li>Auto-deploy dari GitHub</li>
      </ul>
    </div>
  </div>

  <script>
    // Get current URL
    const currentUrl = window.location.origin;
    document.getElementById('webhook-url').textContent = currentUrl + '/api/webhook';
    document.getElementById('base-url').textContent = currentUrl;

    function copyWebhook() {
      const url = document.getElementById('webhook-url').textContent;
      navigator.clipboard.writeText(url).then(() => alert('‚úÖ Webhook URL copied!'));
    }

    function copyBase() {
      const url = document.getElementById('base-url').textContent;
      navigator.clipboard.writeText(url).then(() => alert('‚úÖ Base URL copied!'));
    }

    function showResponse(text) {
      const el = document.getElementById('response');
      el.textContent = text;
      el.classList.add('show');
    }

    async function testDonation() {
      showResponse('Creating test donation...');
      try {
        const res = await fetch('/api/test-donation', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            donor_name: 'TestUser' + Math.floor(Math.random() * 1000),
            amount: Math.floor(Math.random() * 50000) + 10000
          })
        });
        const data = await res.json();
        showResponse('‚úÖ Test donation created!\n\n' + JSON.stringify(data, null, 2));
      } catch (err) {
        showResponse('‚ùå Error: ' + err.message);
      }
    }

    async function getLatest() {
      showResponse('Fetching latest donations...');
      try {
        const res = await fetch('/api/latest-donations');
        const data = await res.json();
        showResponse('üìã Latest Donations:\n\n' + JSON.stringify(data, null, 2));
      } catch (err) {
        showResponse('‚ùå Error: ' + err.message);
      }
    }

    async function getTop() {
      showResponse('Fetching top donators...');
      try {
        const res = await fetch('/api/top-donators?limit=10');
        const data = await res.json();
        showResponse('üèÜ Top Donators:\n\n' + JSON.stringify(data, null, 2));
      } catch (err) {
        showResponse('‚ùå Error: ' + err.message);
      }
    }

    async function clearData() {
      if (!confirm('‚ö†Ô∏è Clear all data?')) return;
      showResponse('Clearing data...');
      try {
        const res = await fetch('/api/clear-data', { method: 'POST' });
        const data = await res.json();
        showResponse('‚úÖ Data cleared!\n\n' + JSON.stringify(data, null, 2));
      } catch (err) {
        showResponse('‚ùå Error: ' + err.message);
      }
    }
  </script>
</body>
</html>